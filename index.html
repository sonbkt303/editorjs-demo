<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor.js Demo</title>
    <link rel="stylesheet" href="node_modules/katex/dist/katex.min.css">
    <link rel="stylesheet" href="node_modules/editorjs-latex/dist/editorjs-latex.bundle.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .editor-wrapper {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            margin-bottom: 20px;
        }

        #editorjs {
            min-height: 400px;
        }

        .controls {
            text-align: center;
            margin-bottom: 20px;
        }

        .btn {
            background: white;
            color: #667eea;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            margin: 0 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .output {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: none;
        }

        .output.show {
            display: block;
        }

        .output h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .output pre {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.5;
        }

        /* Editor.js custom styling */
        .ce-toolbar__content,
        .ce-block__content {
            max-width: 100%;
        }

        .codex-editor__redactor {
            padding-bottom: 0 !important;
        }

        /* Custom inline tool styles */
        .cdx-bold {
            font-weight: bold;
        }

        .cdx-italic {
            font-style: italic;
        }

        .cdx-underline {
            text-decoration: underline;
        }

        .cdx-font-small {
            font-size: 0.85em;
        }

        .cdx-font-normal {
            font-size: 1em;
        }

        .cdx-font-large {
            font-size: 1.25em;
        }

        .cdx-font-xlarge {
            font-size: 1.5em;
        }

        /* Color styles */
        .cdx-text-color {
            color: inherit;
        }

        /* Inline math styles */
        .inline-math {
            display: inline-block;
            margin: 0 2px;
            vertical-align: middle;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìù Editor.js Demo</h1>
            <p>A block-styled editor with clean JSON output</p>
        </header>

        <div class="controls">
            <button class="btn" onclick="saveData()">üíæ Save Data</button>
            <button class="btn" onclick="clearEditor()">üóëÔ∏è Clear Editor</button>
            <button class="btn" onclick="loadSample()">üìÑ Load Sample</button>
        </div>

        <div class="editor-wrapper">
            <div id="editorjs"></div>
        </div>

        <div id="output" class="output">
            <h3>Saved Data (JSON):</h3>
            <pre id="output-data"></pre>
        </div>
    </div>

    <script src="node_modules/@editorjs/editorjs/dist/editorjs.umd.js"></script>
    <script src="node_modules/@editorjs/header/dist/header.umd.js"></script>
    <script src="node_modules/@editorjs/list/dist/list.umd.js"></script>
    <script src="node_modules/@editorjs/image/dist/image.umd.js"></script>
    <script src="node_modules/@editorjs/checklist/dist/checklist.umd.js"></script>
    <script src="node_modules/@editorjs/quote/dist/quote.umd.js"></script>
    <script src="node_modules/@editorjs/code/dist/code.umd.js"></script>
    <script src="node_modules/@editorjs/embed/dist/embed.umd.js"></script>
    <script src="node_modules/@editorjs/table/dist/table.umd.js"></script>
    <script src="node_modules/@editorjs/link/dist/link.umd.js"></script>
    <script src="node_modules/@editorjs/warning/dist/warning.umd.js"></script>
    <script src="node_modules/@editorjs/marker/dist/marker.umd.js"></script>
    <script src="node_modules/@editorjs/inline-code/dist/inline-code.umd.js"></script>
    <script src="node_modules/editorjs-text-color-plugin/dist/bundle.js"></script>
    <script src="node_modules/katex/dist/katex.min.js"></script>
    <script src="node_modules/editorjs-latex/dist/editorjs-latex.bundle.js"></script>

    <script>
        // Debug: Check if ColorPlugin is loaded
        console.log('ColorPlugin loaded:', typeof ColorPlugin !== 'undefined' ? ColorPlugin : 'NOT LOADED');
        console.log('ColorPlugin structure:', ColorPlugin);
        
        // Store reference to avoid issues - handle both default export and direct export
        const TextColorPlugin = typeof ColorPlugin !== 'undefined' ? ColorPlugin : null;
        
        // Custom Bold Inline Tool
        class BoldInlineTool {
            static get isInline() {
                return true;
            }

            static get sanitize() {
                return {
                    b: {},
                    strong: {}
                };
            }

            get state() {
                return this._state;
            }

            set state(state) {
                this._state = state;
                this.button.classList.toggle('ce-inline-tool--active', state);
            }

            constructor({ api }) {
                this.api = api;
                this.button = null;
                this._state = false;
                this.tag = 'B';
                this.class = 'cdx-bold';
            }

            render() {
                this.button = document.createElement('button');
                this.button.type = 'button';
                this.button.innerHTML = '<b>B</b>';
                this.button.classList.add('ce-inline-tool');
                return this.button;
            }

            surround(range) {
                if (this.state) {
                    this.unwrap(range);
                    return;
                }
                this.wrap(range);
            }

            wrap(range) {
                const selectedText = range.extractContents();
                const mark = document.createElement(this.tag);
                mark.classList.add(this.class);
                mark.appendChild(selectedText);
                range.insertNode(mark);
                this.api.selection.expandToTag(mark);
            }

            unwrap(range) {
                const mark = this.api.selection.findParentTag(this.tag, this.class);
                const text = range.extractContents();
                mark.remove();
                range.insertNode(text);
            }

            checkState() {
                const mark = this.api.selection.findParentTag(this.tag);
                this.state = !!mark;
            }

            static get shortcut() {
                return 'CMD+B';
            }
        }

        // Custom Italic Inline Tool
        class ItalicInlineTool {
            static get isInline() {
                return true;
            }

            static get sanitize() {
                return {
                    i: {},
                    em: {}
                };
            }

            get state() {
                return this._state;
            }

            set state(state) {
                this._state = state;
                this.button.classList.toggle('ce-inline-tool--active', state);
            }

            constructor({ api }) {
                this.api = api;
                this.button = null;
                this._state = false;
                this.tag = 'I';
                this.class = 'cdx-italic';
            }

            render() {
                this.button = document.createElement('button');
                this.button.type = 'button';
                this.button.innerHTML = '<i>I</i>';
                this.button.classList.add('ce-inline-tool');
                return this.button;
            }

            surround(range) {
                if (this.state) {
                    this.unwrap(range);
                    return;
                }
                this.wrap(range);
            }

            wrap(range) {
                const selectedText = range.extractContents();
                const mark = document.createElement(this.tag);
                mark.classList.add(this.class);
                mark.appendChild(selectedText);
                range.insertNode(mark);
                this.api.selection.expandToTag(mark);
            }

            unwrap(range) {
                const mark = this.api.selection.findParentTag(this.tag, this.class);
                const text = range.extractContents();
                mark.remove();
                range.insertNode(text);
            }

            checkState() {
                const mark = this.api.selection.findParentTag(this.tag);
                this.state = !!mark;
            }

            static get shortcut() {
                return 'CMD+I';
            }
        }

        // Custom Underline Inline Tool
        class UnderlineInlineTool {
            static get isInline() {
                return true;
            }

            static get sanitize() {
                return {
                    u: {}
                };
            }

            get state() {
                return this._state;
            }

            set state(state) {
                this._state = state;
                this.button.classList.toggle('ce-inline-tool--active', state);
            }

            constructor({ api }) {
                this.api = api;
                this.button = null;
                this._state = false;
                this.tag = 'U';
                this.class = 'cdx-underline';
            }

            render() {
                this.button = document.createElement('button');
                this.button.type = 'button';
                this.button.innerHTML = '<u>U</u>';
                this.button.classList.add('ce-inline-tool');
                return this.button;
            }

            surround(range) {
                if (this.state) {
                    this.unwrap(range);
                    return;
                }
                this.wrap(range);
            }

            wrap(range) {
                const selectedText = range.extractContents();
                const mark = document.createElement(this.tag);
                mark.classList.add(this.class);
                mark.appendChild(selectedText);
                range.insertNode(mark);
                this.api.selection.expandToTag(mark);
            }

            unwrap(range) {
                const mark = this.api.selection.findParentTag(this.tag, this.class);
                const text = range.extractContents();
                mark.remove();
                range.insertNode(text);
            }

            checkState() {
                const mark = this.api.selection.findParentTag(this.tag);
                this.state = !!mark;
            }

            static get shortcut() {
                return 'CMD+U';
            }
        }

        // Custom Inline Math Tool
        class InlineMathTool {
            static get isInline() {
                return true;
            }

            static get sanitize() {
                return {
                    span: {
                        class: 'inline-math'
                    }
                };
            }

            get state() {
                return this._state;
            }

            set state(state) {
                this._state = state;
                this.button.classList.toggle('ce-inline-tool--active', state);
            }

            constructor({ api }) {
                this.api = api;
                this.button = null;
                this._state = false;
                this.tag = 'SPAN';
                this.class = 'inline-math';
            }

            render() {
                this.button = document.createElement('button');
                this.button.type = 'button';
                this.button.innerHTML = '<span style="font-family: serif; font-style: italic;">‚à´</span>';
                this.button.classList.add('ce-inline-tool');
                this.button.title = 'Inline Math (LaTeX)';
                return this.button;
            }

            surround(range) {
                if (this.state) {
                    this.unwrap(range);
                    return;
                }

                // Prompt user for LaTeX expression
                const latex = prompt('Enter LaTeX equation (e.g., x^2, \\frac{a}{b}, \\sqrt{2}):', '');
                if (!latex) return;

                this.wrap(range, latex);
            }

            wrap(range, latex) {
                const span = document.createElement(this.tag);
                span.classList.add(this.class);
                span.setAttribute('data-latex', latex);
                
                // Render using KaTeX
                try {
                    katex.render(latex, span, {
                        throwOnError: false,
                        displayMode: false
                    });
                } catch (e) {
                    span.textContent = latex;
                }
                
                range.deleteContents();
                range.insertNode(span);
                
                // Move cursor after the math
                range.setStartAfter(span);
                range.setEndAfter(span);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
            }

            unwrap(range) {
                const span = this.api.selection.findParentTag(this.tag, this.class);
                if (!span) return;
                
                const latex = span.getAttribute('data-latex') || span.textContent;
                const newLatex = prompt('Edit LaTeX equation:', latex);
                
                if (newLatex === null) return; // User cancelled
                
                if (newLatex === '') {
                    // Delete the math
                    const text = document.createTextNode('');
                    span.parentNode.replaceChild(text, span);
                } else {
                    // Update the math
                    span.setAttribute('data-latex', newLatex);
                    try {
                        katex.render(newLatex, span, {
                            throwOnError: false,
                            displayMode: false
                        });
                    } catch (e) {
                        span.textContent = newLatex;
                    }
                }
            }

            checkState() {
                const span = this.api.selection.findParentTag(this.tag, this.class);
                this.state = !!span;
            }

            static get shortcut() {
                return 'CMD+M';
            }
        }

        // Custom Font Size Inline Tool
        class FontSizeTool {
            static get isInline() {
                return true;
            }

            static get sanitize() {
                return {
                    span: {
                        class: ['cdx-font-small', 'cdx-font-normal', 'cdx-font-large', 'cdx-font-xlarge']
                    }
                };
            }

            get state() {
                return this._state;
            }

            set state(state) {
                this._state = state;
                if (this.button) {
                    this.button.classList.toggle('ce-inline-tool--active', state);
                }
            }

            constructor({ api }) {
                this.api = api;
                this.button = null;
                this._state = false;
                this.tag = 'SPAN';
                this.currentSizeIndex = 1; // Start with Normal
                this.sizes = [
                    { name: 'S', class: 'cdx-font-small', label: 'Small' },
                    { name: 'M', class: 'cdx-font-normal', label: 'Normal' },
                    { name: 'L', class: 'cdx-font-large', label: 'Large' },
                    { name: 'XL', class: 'cdx-font-xlarge', label: 'X-Large' }
                ];
            }

            render() {
                this.button = document.createElement('button');
                this.button.type = 'button';
                this.button.innerHTML = '<svg width="14" height="14" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><text x="0" y="11" font-size="11" font-weight="bold">A</text></svg>';
                this.button.classList.add('ce-inline-tool');
                this.button.title = 'Font Size (cycles through Small ‚Üí Normal ‚Üí Large ‚Üí X-Large)';
                return this.button;
            }

            surround(range) {
                if (!range) return;

                // Find existing span with font size
                const existingSpan = this.api.selection.findParentTag(this.tag);
                let currentIndex = 1; // Default to Normal

                if (existingSpan) {
                    // Find current size
                    for (let i = 0; i < this.sizes.length; i++) {
                        if (existingSpan.classList.contains(this.sizes[i].class)) {
                            currentIndex = i;
                            break;
                        }
                    }

                    // Remove all size classes
                    this.sizes.forEach(size => {
                        existingSpan.classList.remove(size.class);
                    });

                    // Move to next size
                    const nextIndex = (currentIndex + 1) % this.sizes.length;
                    const nextSize = this.sizes[nextIndex];

                    if (nextIndex === 1) {
                        // Normal size - unwrap
                        this.unwrap(range, existingSpan);
                    } else {
                        // Apply new size
                        existingSpan.classList.add(nextSize.class);
                        this.api.selection.expandToTag(existingSpan);
                    }
                } else {
                    // No existing span, create new one with Large size (skip Normal)
                    this.wrap(range, this.sizes[2].class); // Start with Large
                }

                this.updateButtonState();
            }

            wrap(range, sizeClass) {
                const selectedText = range.extractContents();
                const span = document.createElement(this.tag);
                span.classList.add(sizeClass);
                span.appendChild(selectedText);
                range.insertNode(span);
                this.api.selection.expandToTag(span);
            }

            unwrap(range, span) {
                if (!span) {
                    span = this.api.selection.findParentTag(this.tag);
                }
                if (span) {
                    const parent = span.parentNode;
                    while (span.firstChild) {
                        parent.insertBefore(span.firstChild, span);
                    }
                    parent.removeChild(span);
                }
            }

            checkState() {
                const span = this.api.selection.findParentTag(this.tag);
                this.state = !!span;
                this.updateButtonState();
            }

            updateButtonState() {
                const span = this.api.selection.findParentTag(this.tag);
                if (span && this.button) {
                    for (const size of this.sizes) {
                        if (span.classList.contains(size.class)) {
                            this.button.innerHTML = `<strong style="font-size: 12px;">${size.name}</strong>`;
                            return;
                        }
                    }
                }
                if (this.button) {
                    this.button.innerHTML = '<svg width="14" height="14" viewBox="0 0 14 14" xmlns="http://www.w3.org/2000/svg"><text x="0" y="11" font-size="11" font-weight="bold">A</text></svg>';
                }
            }
        }

        let editor;

        // Sample data for demo
        const sampleData = {
            "time": 1672531200000,
            "blocks": [
                {
                    "type": "header",
                    "data": {
                        "text": "üìö Editor.js Complete Guide",
                        "level": 1
                    }
                },
                {
                    "type": "paragraph",
                    "data": {
                        "text": "Welcome to this comprehensive guide for using Editor.js! This document demonstrates all available tools and features. Follow along to learn how to create rich, structured content."
                    }
                },
                {
                    "type": "header",
                    "data": {
                        "text": "‚úçÔ∏è Text Formatting",
                        "level": 2
                    }
                },
                {
                    "type": "paragraph",
                    "data": {
                        "text": "Select text to access the inline toolbar. You can make text <b class=\"cdx-bold\">bold</b>, <i class=\"cdx-italic\">italic</i>, <u class=\"cdx-underline\">underlined</u>, or apply <code class=\"inline-code\">inline code</code> formatting."
                    }
                },
                {
                    "type": "paragraph",
                    "data": {
                        "text": "You can also change <span class=\"cdx-font-small\">font size</span> and add <font style=\"color: #FF1744;\">colored text</font> or <mark style=\"background-color: #FFEB3B;\">highlighted background</mark>."
                    }
                },
                {
                    "type": "warning",
                    "data": {
                        "title": "Keyboard Shortcuts",
                        "message": "Bold (CMD+B), Italic (CMD+I), Underline (CMD+U), Inline Code (CMD+SHIFT+C), Inline Math (CMD+M)"
                    }
                },
                {
                    "type": "header",
                    "data": {
                        "text": "üìù Headers & Hierarchy",
                        "level": 2
                    }
                },
                {
                    "type": "paragraph",
                    "data": {
                        "text": "Use headers to organize your content. Six levels are available:"
                    }
                },
                {
                    "type": "header",
                    "data": {
                        "text": "This is H1 - Main Title",
                        "level": 1
                    }
                },
                {
                    "type": "header",
                    "data": {
                        "text": "This is H2 - Section Title",
                        "level": 2
                    }
                },
                {
                    "type": "header",
                    "data": {
                        "text": "This is H3 - Subsection",
                        "level": 3
                    }
                },
                {
                    "type": "header",
                    "data": {
                        "text": "This is H4 - Smaller heading",
                        "level": 4
                    }
                },
                {
                    "type": "header",
                    "data": {
                        "text": "üìã Lists & Checklists",
                        "level": 2
                    }
                },
                {
                    "type": "paragraph",
                    "data": {
                        "text": "Create unordered lists for items:"
                    }
                },
                {
                    "type": "list",
                    "data": {
                        "style": "unordered",
                        "items": [
                            "First item in the list",
                            "Second item with details",
                            "Third item for examples",
                            "You can add as many as needed"
                        ]
                    }
                },
                {
                    "type": "paragraph",
                    "data": {
                        "text": "Or ordered lists for sequential steps:"
                    }
                },
                {
                    "type": "list",
                    "data": {
                        "style": "ordered",
                        "items": [
                            "First step in the process",
                            "Second step to follow",
                            "Third step to complete",
                            "Final step"
                        ]
                    }
                },
                {
                    "type": "paragraph",
                    "data": {
                        "text": "Use checklists for tasks and to-dos:"
                    }
                },
                {
                    "type": "checklist",
                    "data": {
                        "items": [
                            {
                                "text": "Learn basic text formatting",
                                "checked": true
                            },
                            {
                                "text": "Try creating lists",
                                "checked": true
                            },
                            {
                                "text": "Add images and media",
                                "checked": false
                            },
                            {
                                "text": "Insert code blocks",
                                "checked": false
                            },
                            {
                                "text": "Use math equations",
                                "checked": false
                            }
                        ]
                    }
                },
                {
                    "type": "header",
                    "data": {
                        "text": "üí¨ Quotes & Callouts",
                        "level": 2
                    }
                },
                {
                    "type": "quote",
                    "data": {
                        "text": "Editor.js is a block-styled editor with clean JSON output. Perfect for modern web applications that need structured content.",
                        "caption": "Editor.js Philosophy",
                        "alignment": "left"
                    }
                },
                {
                    "type": "warning",
                    "data": {
                        "title": "Important Note",
                        "message": "Use warning blocks to highlight important information that users should pay attention to."
                    }
                },
                {
                    "type": "header",
                    "data": {
                        "text": "üíª Code Blocks",
                        "level": 2
                    }
                },
                {
                    "type": "paragraph",
                    "data": {
                        "text": "Insert code snippets with proper formatting:"
                    }
                },
                {
                    "type": "code",
                    "data": {
                        "code": "// JavaScript example\nconst editor = new EditorJS({\n  holder: 'editorjs',\n  tools: {\n    header: Header,\n    list: List,\n    code: CodeTool\n  },\n  data: savedData\n});\n\n// Save content\neditor.save().then((outputData) => {\n  console.log('Article data:', outputData);\n});"
                    }
                },
                {
                    "type": "header",
                    "data": {
                        "text": "üìä Tables",
                        "level": 2
                    }
                },
                {
                    "type": "paragraph",
                    "data": {
                        "text": "Create tables to organize data in rows and columns:"
                    }
                },
                {
                    "type": "table",
                    "data": {
                        "withHeadings": true,
                        "content": [
                            ["Feature", "Shortcut", "Description"],
                            ["Bold", "CMD+B", "Make text bold"],
                            ["Italic", "CMD+I", "Make text italic"],
                            ["Inline Code", "CMD+SHIFT+C", "Format as code"],
                            ["Inline Math", "CMD+M", "Insert equation"]
                        ]
                    }
                },
                {
                    "type": "header",
                    "data": {
                        "text": "üî¢ Mathematical Equations",
                        "level": 2
                    }
                },
                {
                    "type": "paragraph",
                    "data": {
                        "text": "Add block-level math equations using LaTeX notation (CMD+SHIFT+M):"
                    }
                },
                {
                    "type": "math",
                    "data": {
                        "text": "E = mc^2"
                    }
                },
                {
                    "type": "paragraph",
                    "data": {
                        "text": "The quadratic formula:"
                    }
                },
                {
                    "type": "math",
                    "data": {
                        "text": "x = \\frac{-b \\pm \\sqrt{b^2 - 4ac}}{2a}"
                    }
                },
                {
                    "type": "paragraph",
                    "data": {
                        "text": "Integration example:"
                    }
                },
                {
                    "type": "math",
                    "data": {
                        "text": "\\int_0^\\infty e^{-x^2} dx = \\frac{\\sqrt{\\pi}}{2}"
                    }
                },
                {
                    "type": "paragraph",
                    "data": {
                        "text": "You can also add inline math within paragraphs using CMD+M while selecting text. For example: the Pythagorean theorem a¬≤ + b¬≤ = c¬≤ is fundamental in geometry."
                    }
                },
                {
                    "type": "header",
                    "data": {
                        "text": "üé® Color & Styling",
                        "level": 2
                    }
                },
                {
                    "type": "paragraph",
                    "data": {
                        "text": "Select text and use the color picker to add <font style=\"color: #FF1744;\">red</font>, <font style=\"color: #2979FF;\">blue</font>, <font style=\"color: #00E676;\">green</font>, or any custom color to your text."
                    }
                },
                {
                    "type": "paragraph",
                    "data": {
                        "text": "Use the marker tool for <mark style=\"background-color: #FFEB3B;\">yellow highlights</mark>, <mark style=\"background-color: #FF5722;\">orange emphasis</mark>, or <mark style=\"background-color: #9C27B0;\">purple backgrounds</mark>."
                    }
                },
                {
                    "type": "header",
                    "data": {
                        "text": "‚ö° Quick Tips",
                        "level": 2
                    }
                },
                {
                    "type": "list",
                    "data": {
                        "style": "unordered",
                        "items": [
                            "Press <b>+ button</b> or <b>Tab</b> to add new blocks",
                            "Use <b>CMD+B</b>, <b>CMD+I</b>, <b>CMD+U</b> for quick formatting",
                            "Press <b>CMD+M</b> to insert inline math equations",
                            "Press <b>CMD+SHIFT+M</b> to add a math block",
                            "Click dropdown arrow on color tools to open color picker",
                            "Select text first, then apply formatting",
                            "Drag blocks by the handle to reorder them",
                            "Press <b>Backspace</b> on empty block to delete it"
                        ]
                    }
                },
                {
                    "type": "header",
                    "data": {
                        "text": "üì§ Saving Your Work",
                        "level": 2
                    }
                },
                {
                    "type": "paragraph",
                    "data": {
                        "text": "Click the <b>üíæ Save Data</b> button above to see the JSON output. This structured data can be easily stored in a database and rendered consistently across different platforms."
                    }
                },
                {
                    "type": "quote",
                    "data": {
                        "text": "Start creating your own content by clicking üóëÔ∏è Clear Editor and begin typing!",
                        "caption": "Get Started",
                        "alignment": "center"
                    }
                }
            ],
            "version": "2.29.1"
        };

        // Initialize Editor.js
        function initEditor(data = null) {
            // Build tools configuration
            const tools = {
                header: {
                    class: Header,
                    inlineToolbar: true,
                    config: {
                        placeholder: 'Enter a header',
                        levels: [1, 2, 3, 4, 5, 6],
                        defaultLevel: 2
                    }
                },
                list: {
                    class: List,
                    inlineToolbar: true,
                    config: {
                        defaultStyle: 'unordered'
                    }
                },
                checklist: {
                    class: Checklist,
                    inlineToolbar: true
                },
                quote: {
                    class: Quote,
                    inlineToolbar: true,
                    config: {
                        quotePlaceholder: 'Enter a quote',
                        captionPlaceholder: 'Quote author'
                    }
                },
                code: {
                    class: CodeTool,
                    config: {
                        placeholder: 'Enter code'
                    }
                },
                warning: {
                    class: Warning,
                    inlineToolbar: true,
                    config: {
                        titlePlaceholder: 'Title',
                        messagePlaceholder: 'Message'
                    }
                },
                inlineCode: {
                    class: InlineCode,
                    shortcut: 'CMD+SHIFT+C'
                },
                inlineMath: {
                    class: InlineMathTool,
                    shortcut: 'CMD+M'
                },
                bold: {
                    class: BoldInlineTool,
                    shortcut: 'CMD+B'
                },
                italic: {
                    class: ItalicInlineTool,
                    shortcut: 'CMD+I'
                },
                underline: {
                    class: UnderlineInlineTool,
                    shortcut: 'CMD+U'
                },
                fontSize: {
                    class: FontSizeTool
                },
                table: {
                    class: Table,
                    inlineToolbar: true
                },
                embed: {
                    class: Embed,
                    config: {
                        services: {
                            youtube: true,
                            vimeo: true,
                            twitter: true
                        }
                    }
                },
                linkTool: {
                    class: LinkTool,
                    config: {
                        endpoint: 'http://localhost:8008/fetchUrl' // Mock endpoint
                    }
                },
                math: {
                    class: EJLaTeX,
                    shortcut: 'CMD+SHIFT+M'
                }   
            };

            // Add color tools only if plugin is available
            if (TextColorPlugin) {
                // Create a factory function for Color tools with hardcoded config
                const createColorToolClass = (toolConfig) => {
                    return class {
                        constructor({api}) {
                            this.api = api;
                            this.config = toolConfig;
                            this.clickedOnLeft = false;
                            this.pluginType = this.config.type || 'text';
                            this.parentTag = this.pluginType === 'marker' ? 'MARK' : 'FONT';
                            this.hasCustomPicker = this.config.customPicker || false;
                            this.color = this.config.defaultColor;
                            this.picker = null;
                            this.icon = null;
                            this.button = null;
                            this.iconClasses = {
                                base: this.api.styles.inlineToolButton,
                                active: this.api.styles.inlineToolButtonActive
                            };
                        }

                        static get isInline() {
                            return true;
                        }

                        render() {
                            this.button = document.createElement('button');
                            this.button.type = 'button';
                            this.button.classList.add('colorPlugin');
                            this.button.classList.add(this.iconClasses.base);
                            this.button.style.display = 'flex';
                            this.button.style.alignItems = 'center';

                            // Create left button (apply color)
                            this.icon = document.createElement('div');
                            this.icon.id = 'color-left-btn';
                            this.icon.style.cssText = 'height: 35px; width: 18px; font-weight: 600; display: flex; align-items: center; cursor: pointer;';
                            
                            const iconSvg = this.pluginType === 'marker' 
                                ? '<svg fill="currentColor" width="16" height="16" viewBox="0 0 32 32"><path d="M17.6,6L6.9,16.7c-0.2,0.2-0.3,0.4-0.3,0.6L6,23.9c0,0.3,0.1,0.6,0.3,0.8C6.5,24.9,6.7,25,7,25c0,0,0.1,0,0.1,0l6.6-0.6 c0.2,0,0.5-0.1,0.6-0.3L25,13.4L17.6,6z"/><path d="M26.4,12l1.4-1.4c1.2-1.2,1.1-3.1-0.1-4.3l-3-3c-0.6-0.6-1.3-0.9-2.2-0.9c-0.8,0-1.6,0.3-2.2,0.9L19,4.6L26.4,12z"/><path d="M28,29H4c-0.6,0-1-0.4-1-1s0.4-1,1-1h24c0.6,0,1,0.4,1,1S28.6,29,28,29z"/></svg>'
                                : '<svg fill="currentColor" width="16" height="16" viewBox="-6 0 512 512"><path d="M365 432L328 352 172 352 135 432 64 432 227 80 272 80 436 432 365 432ZM201 288L299 288 250 183 201 288Z"></path></svg>';
                            this.icon.innerHTML = iconSvg;
                            this.icon.addEventListener('click', () => {
                                this.clickedOnLeft = true;
                            });

                            // Create color indicator bar
                            const colorBar = document.createElement('div');
                            colorBar.style.cssText = `width: 16px; height: 3px; background: ${this.color}; position: absolute; bottom: 4px; left: 4px;`;
                            this.colorBar = colorBar;

                            // Create dropdown button
                            const dropdown = document.createElement('div');
                            dropdown.style.cssText = 'width: 8px; height: 35px; display: flex; align-items: center; cursor: pointer; font-size: 8px;';
                            dropdown.innerHTML = '‚ñº';
                            dropdown.addEventListener('click', (e) => {
                                e.stopPropagation();
                                this.showColorPicker(e);
                            });

                            this.button.appendChild(this.icon);
                            this.button.appendChild(colorBar);
                            this.button.appendChild(dropdown);
                            this.button.style.position = 'relative';

                            return this.button;
                        }

                        showColorPicker(e) {
                            // Remove existing picker
                            const existingPicker = document.querySelector('.color-picker-popup');
                            if (existingPicker) {
                                existingPicker.remove();
                                return;
                            }

                            // Save the current selection
                            const selection = window.getSelection();
                            if (!selection.rangeCount) return;
                            
                            const savedRange = selection.getRangeAt(0).cloneRange();

                            const picker = document.createElement('div');
                            picker.className = 'color-picker-popup';
                            picker.style.cssText = `
                                position: fixed;
                                z-index: 9999;
                                background: white;
                                padding: 10px;
                                border-radius: 8px;
                                box-shadow: 0 4px 20px rgba(0,0,0,0.25);
                                display: grid;
                                grid-template-columns: repeat(5, 1fr);
                                gap: 6px;
                                max-width: 180px;
                            `;

                            const applyColor = (selectedColor) => {
                                this.color = selectedColor;
                                this.colorBar.style.background = selectedColor;
                                
                                // Restore selection and apply color
                                selection.removeAllRanges();
                                selection.addRange(savedRange);
                                
                                // Apply the color to the selected text
                                const existingMark = this.api.selection.findParentTag(this.parentTag);
                                if (existingMark) {
                                    // Update existing mark color
                                    if (this.pluginType === 'marker') {
                                        existingMark.style.backgroundColor = selectedColor;
                                    } else {
                                        existingMark.style.color = selectedColor;
                                    }
                                } else {
                                    // Create new mark
                                    const range = selection.getRangeAt(0);
                                    this.wrap(range);
                                }
                                
                                picker.remove();
                            };

                            // Add custom color picker first
                            if (this.hasCustomPicker) {
                                const customBtn = document.createElement('input');
                                customBtn.type = 'color';
                                customBtn.value = this.color;
                                customBtn.style.cssText = 'width: 24px; height: 24px; border: 2px solid #ddd; border-radius: 4px; cursor: pointer; padding: 0;';
                                customBtn.addEventListener('input', (event) => {
                                    applyColor(event.target.value);
                                });
                                picker.appendChild(customBtn);
                            }

                            // Add color buttons
                            this.config.colorCollections.forEach(color => {
                                const btn = document.createElement('button');
                                btn.style.cssText = `
                                    width: 24px;
                                    height: 24px;
                                    background: ${color};
                                    border: 1px solid #ccc;
                                    border-radius: 4px;
                                    cursor: pointer;
                                `;
                                btn.addEventListener('click', (e) => {
                                    e.preventDefault();
                                    applyColor(color);
                                });
                                picker.appendChild(btn);
                            });

                            // Position the picker
                            const rect = this.button.getBoundingClientRect();
                            picker.style.left = rect.left + 'px';
                            picker.style.top = (rect.bottom + 5) + 'px';

                            document.body.appendChild(picker);

                            // Close on outside click
                            const closeHandler = (event) => {
                                if (!picker.contains(event.target) && !this.button.contains(event.target)) {
                                    picker.remove();
                                    document.removeEventListener('click', closeHandler);
                                }
                            };
                            setTimeout(() => document.addEventListener('click', closeHandler), 0);
                        }

                        surround(range) {
                            if (!range) return;

                            const existingMark = this.api.selection.findParentTag(this.parentTag);
                            if (existingMark) {
                                if (this.clickedOnLeft) {
                                    // Remove the mark
                                    this.unwrap(existingMark);
                                } else {
                                    // Update color
                                    if (this.pluginType === 'marker') {
                                        existingMark.style.backgroundColor = this.color;
                                    } else {
                                        existingMark.style.color = this.color;
                                    }
                                }
                            } else {
                                this.wrap(range);
                            }
                            this.clickedOnLeft = false;
                        }

                        wrap(range) {
                            const selectedText = range.extractContents();
                            const mark = document.createElement(this.parentTag);
                            
                            if (this.pluginType === 'marker') {
                                mark.style.backgroundColor = this.color;
                            } else {
                                mark.style.color = this.color;
                            }
                            
                            mark.appendChild(selectedText);
                            range.insertNode(mark);
                            this.api.selection.expandToTag(mark);
                        }

                        unwrap(mark) {
                            const parent = mark.parentNode;
                            while (mark.firstChild) {
                                parent.insertBefore(mark.firstChild, mark);
                            }
                            parent.removeChild(mark);
                        }

                        checkState() {
                            const mark = this.api.selection.findParentTag(this.parentTag);
                            this.button.classList.toggle(this.iconClasses.active, !!mark);
                            return !!mark;
                        }

                        static get sanitize() {
                            return {
                                font: true,
                                mark: true
                            };
                        }
                    };
                };

                tools.Color = {
                    class: createColorToolClass({
                        colorCollections: ['#FF1744','#F50057','#D500F9','#651FFF',
                                           '#3D5AFE','#2979FF','#00B0FF','#00E5FF',
                                           '#1DE9B6','#00E676','#76FF03','#C6FF00',
                                           '#FFEA00','#FFC400','#FF9100','#FF3D00',
                                           '#000000','#424242','#9E9E9E','#FFFFFF'],
                        defaultColor: '#FF1744',
                        type: 'text',
                        customPicker: true
                    })
                };
                tools.Marker = {
                    class: createColorToolClass({
                        colorCollections: ['#FFEB3B','#FFC107','#FF9800','#FF5722',
                                           '#F44336','#E91E63','#9C27B0','#673AB7',
                                           '#3F51B5','#2196F3','#03A9F4','#00BCD4',
                                           '#009688','#4CAF50','#8BC34A','#CDDC39'],
                        defaultColor: '#FFEB3B',
                        type: 'marker',
                        customPicker: true
                    })
                };
            }

            editor = new EditorJS({
                holder: 'editorjs',
                autofocus: true,
                placeholder: 'Start typing or click + to add a block...',
                data: data,
                tools: tools,
                onChange: () => {
                    console.log('Content changed');
                },
                onReady: () => {
                    console.log('Editor.js is ready to work!');
                }
            });
        }

        // Save editor data
        async function saveData() {
            try {
                const outputData = await editor.save();
                document.getElementById('output-data').textContent = JSON.stringify(outputData, null, 2);
                document.getElementById('output').classList.add('show');
                console.log('Saved data:', outputData);
            } catch (error) {
                console.error('Saving failed:', error);
                alert('Failed to save data!');
            }
        }

        // Clear editor
        async function clearEditor() {
            if (confirm('Are you sure you want to clear the editor?')) {
                await editor.clear();
                document.getElementById('output').classList.remove('show');
            }
        }

        // Load sample data
        async function loadSample() {
            if (editor) {
                await editor.destroy();
            }
            initEditor(sampleData);
        }

        // Initialize editor on page load
        // Wait for ColorPlugin to be available
        if (!TextColorPlugin) {
            console.error('ColorPlugin not loaded. Initializing without color support.');
        } else {
            console.log('Initializing editor with color support');
        }
        initEditor(sampleData);
    </script>
</body>
</html>
